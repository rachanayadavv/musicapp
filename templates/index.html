<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Player</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h1>Music Player</h1>
    <div class="add-song">
        <button onclick="openFileDialog()">Add Song</button>
        <input type="file" id="fileInput" accept="audio/*" style="display: none;" onchange="addSong()">
    </div>
    <ul class="song-list">
        {% for song_name, song_path in songs.items() %}
            <li id="song-{{ loop.index }}" class="song-item">
                <span>{{ song_name }}</span>
                <div>
                    <button onclick="playSong('{{ song_name }}', 'song-{{ loop.index }}')">Play</button>
                    <button onclick="deleteSong('{{ song_name }}')">Delete</button>
                </div>
            </li>
        {% endfor %}
    </ul>
    <div class="controls">
        <button onclick="pauseSong()">Pause</button>
        <button onclick="resumeSong()">Resume</button>
        <button onclick="stopSong()">Stop</button>
    </div>
    <p id="status">Status: Idle</p>

    <script>
        let currentPlaying = null;

        function openFileDialog() {
            document.getElementById('fileInput').click();
        }

        function addSong() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (!file) {
                alert("No file selected");
                return;
            }

            const formData = new FormData();
            formData.append('song_file', file);

            fetch('/add_song', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    updateStatus('Song added: ' + file.name);
                    location.reload(); // Reload to see the updated list
                } else {
                    alert(data.message); // Show message if the song already exists
                }
            });
        }

        function playSong(songName, songElementId) {
            fetch('/play', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ song_name: songName })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'playing') {
                    updateStatus('Playing: ' + data.song_name);
                    highlightPlaying(songElementId);
                } else {
                    updateStatus('Error: ' + data.message);
                }
            });
        }

        function deleteSong(songName) {
            fetch('/delete_song', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ song_name: songName })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert(data.message); // Show a popup message
                    location.reload(); // Reload to see the updated list
                } else {
                    updateStatus('Error: ' + data.message);
                }
            });
        }

        function highlightPlaying(songElementId) {
            if (currentPlaying) {
                currentPlaying.classList.remove('playing');
            }
            currentPlaying = document.getElementById(songElementId);
            if (currentPlaying) {
                currentPlaying.classList.add('playing');
            }
        }

        function updateStatus(message) {
            document.getElementById('status').innerText = 'Status: ' + message;
        }

        function pauseSong() {
            fetch('/pause', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'paused') {
                    updateStatus('Paused');
                }
            });
        }

        function resumeSong() {
            fetch('/resume', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'resumed') {
                    updateStatus('Resumed');
                }
            });
        }

        function stopSong() {
            fetch('/stop', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'stopped') {
                    updateStatus('Stopped');
                    if (currentPlaying) {
                        currentPlaying.classList.remove('playing');
                    }
                }
            });
        }
    </script>
</body>
</html>
